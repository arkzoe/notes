- 将主数据库的DDL和DML操作通过二进制日志传到从库服务器中，在从库是执行，保持同步
- 支持一台主库同时向多台从库复制，从库也可以作为主库，实现链状复制
- 优
	- 主库出现问题,可以快速切换到从库提供服务
	- 实现读写分离,降低主库的访问压力
	- 可以在从库中执行备份,以避免备份期间影响主库服务
# 原理
1. Master 主库在事务提交时,会把数据变更记录在二进制日志文件Binlog中
2. 从库读取主库的二进制日志文件Binlog,写入到从库的中继日志Relay Log
3. slave重做中继日志中的事件,将改变反映它自己的数据
# 搭建
- 服务器
```shell
# 开发3306
firewall-cmd--zone=public --add-port=3306/tcp-permanent
firewall-cmd-reload
# 关闭服务器
systemctl stop firewall
systemctl disable firewall
```
### 主库
1. 修改配置文件/etc/my.cnf
```mysql
#mysql服务ID，保证集群环境中唯一，取值1-2^32-1，默认1
server-id=1
# 是否只读，1只读，0读写
read-only=0
# 忽略数量，指不需要同步的数据库
# binlog-ignore-db=mysql
# 指定同步的数据库
# binlog-do-db=db01
```
2. 重启mysql
3. 创建远程连接账户，赋予主从复制权限
```mysql
# 创建用户设置密码
CREATE USER 'itcast'@'%' IDENTIFIED WITH mysql_native_password BY ''
# 分配主从复制权限
GRANT REPLICATION SLAVE ON '.' TO 'itcast'@'%';
```
4. 查看二进制日志坐标
```mysql
show master status;
```
- file：从那个文件开始推送日志文件
- position：从那个位置开始推送日志
- binlog_ignore_db：指定不需要同步的数据库
### 从库
1. 修改配置文件/etc/my.cnf
```mysql
#mysql服务ID，保证集群环境中唯一，取值1-2^32-1，和主库不一样
server-id=2
# 是否只读，1只读，0读写
read-only=1
```
2. 重启mysql
3. 设置主库配置
```mysql
CHANGE REPLICATION SOURCE TO SOURCE_HOST='xxx.xxx', SOURCE_USER='xxx', SOURCE_PASSWORD='xxx', SOURCE_LOG_FILE='xxx', SOURCE_LOG_POS=xxx;

上述是8.0.23中的语法。如果mysql是8.0.23之前的版本,执行如下SQL:

CHANGE MASTER TO MASTER_HOST='xxx.xxx.xxx.xxx', MASTER_USER='xxx', MASTER_PASSWORD='xxx', MASTER_LOG_FILE='xxx', MASTER_LOG_POS=xxx;
```

| 参数名             | 含义           | 8.0.23之前        |
| --------------- | ------------ | --------------- |
| SOURCE_HOST     | 主库IP         | MASTER_HOST     |
| SOURCE_USER     | 连接主库的用户名     | MASTER_USER     |
| SOURCE_PASSWORD | 密码           | MASTER_PASSWORD |
| SOURCE_LOG_FILE | binlog日志文件名  | MASTER_LOG_FILE |
| SOURCE_LOG_POS  | binlog日志文件位置 | MASTER_LOG_POS  |
- 开启同步
```mysql
start replica;#8.0.22之后
start slavel;#8.0.22之前
```
- 查看主从同步状态
```mysql
show replica status;#8.0.22之后
show slave status;#8.0.22之前
```